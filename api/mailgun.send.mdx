---
id: mailgun-send
source: mailgun
function: send
name: Mailgun Send Email
description: Send emails via Mailgun's powerful API with SMTP relay
method: POST
path: /v3/{domain}/messages
category: email-service-provider
authentication:
  type: api_key
  location: header
  key_name: Authorization
  value_prefix: Basic api
rate_limits:
  free: 100 requests/second
  foundation: 300 requests/second
  growth: 600 requests/second
cost:
  free_tier: 5000 emails total
  foundation: $0.80 per 1000 emails
  growth: $0.70 per 1000 emails (50K-100K)
request_schema:
  from:
    type: string
    required: true
    description: Sender email address
    example: Sales Team <hello@yourdomain.com>
  to:
    type: string or array
    required: true
    description: Recipient email address(es)
    example: recipient@example.com
  cc:
    type: string or array
    description: CC recipients
  bcc:
    type: string or array
    description: BCC recipients
  subject:
    type: string
    required: true
    description: Email subject line
  text:
    type: string
    description: Plain text version
  html:
    type: string
    description: HTML version
  attachment:
    type: file or array
    description: File attachments
  inline:
    type: file or array
    description: Inline images
  template:
    type: string
    description: Mailgun template name
  h_variables:
    type: object
    description: Template variables (JSON string)
  o_tag:
    type: string or array
    description: Tags for analytics (max 3)
    example: campaign-123
  o_tracking:
    type: boolean
    default: true
    description: Enable tracking
  o_tracking_clicks:
    type: boolean or string
    default: true
    values: [true, false, htmlonly]
  o_tracking_opens:
    type: boolean
    default: true
  o_testmode:
    type: boolean
    default: false
    description: Test mode (no actual sending)
  o_deliverytime:
    type: string
    description: Scheduled delivery (RFC 2822 format)
  v_custom:
    type: string
    description: Custom variables (prefix with v:)
response_schema:
  success:
    status: 200
    body:
      id: string (message ID)
      message: string ("Queued. Thank you.")
  error:
    status: 4xx or 5xx
    body:
      message: string
metadata:
  ns: api
  visibility: public
tags:
  - email
  - esp
  - mailgun
  - transactional
---

# Mailgun Send Email API

Send transactional and marketing emails using Mailgun's powerful API with flexible tracking, templating, and deliverability tools.

## Features

- **Powerful API**: RESTful with extensive features
- **SMTP Relay**: Standard SMTP for any application
- **Email Validation**: Built-in address verification
- **Detailed Analytics**: Opens, clicks, bounces, complaints
- **Scheduled Delivery**: Queue emails for future sending
- **Templates**: Server-side Handlebars templating

## Usage

```typescript
export async function sendEmail(params: SendEmailParams): Promise<SendEmailResponse> {
  const domain = params.domain || process.env.MAILGUN_DOMAIN
  const formData = new FormData()

  // Add required fields
  formData.append('from', params.from)
  formData.append('to', Array.isArray(params.to) ? params.to.join(',') : params.to)
  formData.append('subject', params.subject)

  // Add content
  if (params.html) formData.append('html', params.html)
  if (params.text) formData.append('text', params.text)

  // Add optional fields
  if (params.cc) formData.append('cc', params.cc)
  if (params.bcc) formData.append('bcc', params.bcc)
  if (params.template) formData.append('template', params.template)

  // Add tracking options
  if (params.trackOpens !== undefined) {
    formData.append('o:tracking-opens', params.trackOpens.toString())
  }
  if (params.trackClicks !== undefined) {
    formData.append('o:tracking-clicks', params.trackClicks.toString())
  }

  // Add tags
  if (params.tags) {
    params.tags.slice(0, 3).forEach(tag => formData.append('o:tag', tag))
  }

  // Add custom variables
  if (params.customVars) {
    Object.entries(params.customVars).forEach(([key, value]) => {
      formData.append(`v:${key}`, JSON.stringify(value))
    })
  }

  const response = await fetch(
    `https://api.mailgun.net/v3/${domain}/messages`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Basic ${btoa(`api:${process.env.MAILGUN_API_KEY}`)}`,
      },
      body: formData,
    }
  )

  if (!response.ok) {
    const error = await response.json()
    throw new Error(`Mailgun error: ${error.message}`)
  }

  return response.json()
}

// Example: Simple email
await sendEmail({
  from: 'Sales Team <hello@yourdomain.com>',
  to: 'recipient@example.com',
  subject: 'Welcome to Our Platform',
  html: '<h1>Welcome!</h1><p>Thanks for signing up.</p>',
  text: 'Welcome! Thanks for signing up.',
  trackOpens: true,
  trackClicks: true,
  tags: ['onboarding', 'welcome'],
  customVars: {
    user_id: 'user-123',
    campaign_id: 'campaign-456',
  },
})

// Example: Batch send
await sendEmail({
  from: 'hello@yourdomain.com',
  to: ['user1@example.com', 'user2@example.com', 'user3@example.com'],
  subject: 'Newsletter',
  html: '<p>Check out our latest updates!</p>',
  tags: ['newsletter'],
})

// Example: Using template
await sendEmail({
  from: 'hello@yourdomain.com',
  to: 'user@example.com',
  subject: 'Verify Your Email',
  template: 'email-verification',
  customVars: {
    verification_link: 'https://example.com/verify/abc123',
    first_name: 'John',
  },
})

// Example: Scheduled send
await sendEmail({
  from: 'hello@yourdomain.com',
  to: 'user@example.com',
  subject: 'Reminder',
  html: '<p>Don\'t forget about tomorrow\'s meeting!</p>',
  deliveryTime: 'Wed, 04 Oct 2025 08:00:00 -0700',
})
```

## Response Example

```typescript
// Success (200 OK)
{
  id: '<20250104120000.1.ABCD1234567890@yourdomain.com>',
  message: 'Queued. Thank you.'
}

// Error (400 Bad Request)
{
  message: 'from parameter is missing'
}
```

## Best Practices

### Domain Authentication
```typescript
// Use verified sending domain
const verifiedDomain = 'mg.yourdomain.com' // Not your main domain

await sendEmail({
  domain: verifiedDomain,
  from: `Sales Team <hello@${verifiedDomain}>`,
  // ... rest of params
})
```

### Deliverability Tips
- ✅ Set up SPF and DKIM records
- ✅ Use dedicated sending subdomain (mg.yourdomain.com)
- ✅ Monitor bounce rates (keep < 5%)
- ✅ Handle unsubscribes promptly
- ✅ Warm up new domains gradually
- ✅ Use consistent from addresses
- ✅ Segment your audience

### Error Handling with Retry
```typescript
async function sendWithRetry(params: SendEmailParams, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await sendEmail(params)
    } catch (error) {
      const shouldRetry = error.status >= 500 || error.status === 429

      if (shouldRetry && i < maxRetries - 1) {
        // Exponential backoff
        await sleep(Math.pow(2, i) * 1000)
        continue
      }

      throw error
    }
  }
}
```

### Batch Processing
```typescript
// Process emails in batches to respect rate limits
async function sendBatch(emails: EmailParams[], batchSize = 100) {
  const results = []

  for (let i = 0; i < emails.length; i += batchSize) {
    const batch = emails.slice(i, i + batchSize)

    // Process batch with rate limiting
    const batchResults = await Promise.all(
      batch.map(async (email) => {
        try {
          return await sendEmail(email)
        } catch (error) {
          return { error: error.message, email }
        }
      })
    )

    results.push(...batchResults)

    // Wait between batches
    if (i + batchSize < emails.length) {
      await sleep(1000) // 1 second between batches
    }
  }

  return results
}
```

### Custom Variables
```typescript
// Add metadata for webhook correlation
await sendEmail({
  from: 'hello@yourdomain.com',
  to: 'user@example.com',
  subject: 'Your Order',
  html: '<p>Order confirmation...</p>',
  customVars: {
    order_id: 'order-123',
    user_id: 'user-456',
    amount: 99.99,
    timestamp: Date.now(),
  },
})
```

## Webhook Events

Mailgun sends webhooks for these events:
- `delivered` - Successfully delivered
- `opened` - Email opened
- `clicked` - Link clicked
- `unsubscribed` - Recipient unsubscribed
- `complained` - Spam complaint
- `bounced` - Hard or soft bounce
- `failed` - Permanent failure

Configure webhook endpoint:
```
https://api.services.do/webhooks/mailgun
```

## Error Codes

| Status | Meaning | Action |
|--------|---------|--------|
| 200 | Success | Email queued |
| 400 | Bad Request | Fix payload |
| 401 | Unauthorized | Check API key |
| 402 | Request Failed | Insufficient credits |
| 404 | Not Found | Check domain |
| 429 | Rate Limited | Implement backoff |
| 5xx | Server Error | Retry later |

## Integration with ESP Gateway

```typescript
// Normalized interface via esp-gateway service
const result = await env.ESP_GATEWAY.send({
  provider: 'mailgun',
  message: {
    to: 'recipient@example.com',
    from: { email: 'hello@yourdomain.com', name: 'Sales Team' },
    subject: 'Cold Email Subject',
    html: '<p>Email content</p>',
    text: 'Email content',
  },
  options: {
    trackOpens: true,
    trackClicks: true,
    tags: ['campaign-123', 'cold-email'],
    customVars: {
      campaign_id: 'campaign-123',
    },
  },
})
```

## Attachments

```typescript
// Add file attachments
const formData = new FormData()
formData.append('from', 'hello@yourdomain.com')
formData.append('to', 'user@example.com')
formData.append('subject', 'Invoice')
formData.append('html', '<p>Please find attached invoice.</p>')

// Add attachment (File or Blob)
formData.append('attachment', fileBlob, 'invoice.pdf')

// Add inline image
formData.append('inline', imageBlob, 'logo.png')
```

## Templates

```typescript
// Create template via API first, then use
await sendEmail({
  from: 'hello@yourdomain.com',
  to: 'user@example.com',
  subject: 'Welcome {{name}}!',
  template: 'welcome-email',
  customVars: {
    name: 'John',
    verification_link: 'https://example.com/verify/abc',
    company_name: 'Acme Corp',
  },
})
```

## Related APIs

- [mailgun.validate](./mailgun.validate.mdx) - Validate email addresses
- [sendgrid.send](./sendgrid.send.mdx) - Alternative ESP
- [amazon-ses.send](./amazon-ses.send.mdx) - Alternative ESP

export { sendEmail, sendWithRetry, sendBatch }
